<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
xmlns:beans="http://www.springframework.org/schema/beans"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security.xsd">

    <global-method-security pre-post-annotations="disabled"><!-- 
        <expression-handler ref="expressionHandler"/> -->
    </global-method-security>

    <http pattern="/**/*.ico" security="none"/>
    <http pattern="/**/*.jpg" security="none"/>
    <http pattern="/**/*.png" security="none"/>
    <http pattern="/**/*.gif" security="none"/>
    <http pattern="/**/*.svg" security="none"/>
    <http pattern="/**/*.ttf" security="none"/>
    <http pattern="/**/*.css" security="none"/>
    <http pattern="/**/*.js" security="none"/>
    <!-- use-expressions: WebSecurityExpressionRoot -->
    <http>
        <intercept-url pattern="/" access="permitAll()"/>
        <intercept-url pattern="/default.html" access="permitAll()"/>
        <intercept-url pattern="/index.jsp" access="isAnonymous()"/>
        <intercept-url pattern="/hello.htm" access="isAnonymous()"/>
        <intercept-url pattern="/login*" access="isAnonymous()"/><!-- 
        <intercept-url pattern="/j_spring_security_check" access="isAnonymous()"/>
        <intercept-url pattern="/switchuser.jsp" access="ROLE_SUPERVISOR"/>
        <intercept-url pattern="/j_spring_security_switch_user" access="ROLE_SUPERVISOR"/> -->
        <intercept-url pattern="/**" access="isAuthenticated()"/>

        <form-login login-page="/login" login-processing-url="/auth" authentication-failure-url="/login?error=1" username-parameter="u" password-parameter="p"/>
        <http-basic/>
        <!-- invalidate-session="true" show invalid-session-url  -->
        <logout invalidate-session="true" logout-success-url="/index?error=2" logout-url="/logout" />
        <remember-me remember-me-parameter="r" />
        <csrf disabled="true"/>
        <!-- 
        <custom-filter ref="switchUserProcessingFilter" position="SWITCH_USER_FILTER"/> -->
        <session-management invalid-session-url="/login?error=3" session-fixation-protection="none">
        	<concurrency-control max-sessions="1" error-if-maximum-exceeded="true"/>
        </session-management>
    </http>

    <authentication-manager alias="authenticationManager">
        <authentication-provider user-service-ref="userManager">
           <password-encoder hash="plaintext"/>
        </authentication-provider>
    </authentication-manager>
    
    <beans:bean id="userManager" class="org.springframework.security.provisioning.JdbcUserDetailsManager">
    	<beans:property name="dataSource" ref="dataSource" />
    	<beans:property name="enableAuthorities" value="true" />
    	<beans:property name="enableGroups" value="false" />
    	<beans:property name="authenticationManager" ref="authenticationManager" />
    </beans:bean>

    <!-- Automatically receives AuthenticationEvent messages -->
    <beans:bean id="loggerListener" class="org.springframework.security.authentication.event.LoggerListener"/>

    <!-- Filter used to switch the user context. Note: the switch and exit url must be secured
        based on the role granted the ability to 'switch' to another user -->
    <!-- In this example 'rod' has ROLE_SUPERVISOR that can switch to regular ROLE_USER(s)
    <beans:bean id="switchUserProcessingFilter" class="org.springframework.security.web.authentication.switchuser.SwitchUserFilter" autowire="byType">
       <b:property name="targetUrl" value="/secure/index.htm"/>
    </beans:bean> -->
<!-- 
    <beans:bean id="expressionHandler" class="org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler">
        <b:property name="permissionEvaluator" ref="permissionEvaluator"/>
    </beans:bean>

    <beans:bean id="permissionEvaluator" class="org.springframework.security.acls.AclPermissionEvaluator">
        <b:constructor-arg ref="aclService"/>
    </beans:bean> -->
</beans:beans>
